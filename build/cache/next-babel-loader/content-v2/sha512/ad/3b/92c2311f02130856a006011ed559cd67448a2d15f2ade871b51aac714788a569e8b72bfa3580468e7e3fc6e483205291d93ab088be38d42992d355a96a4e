{"ast":null,"code":"import { openDB } from \"idb\";\nimport { showUpgradeBlockedMessage } from \"./showUpgradeBlockedMessage\";\nimport { upgradeDatabase } from \"./upgradeDatabase\";\nexport const openDatabase = async () => {\n  return openDB(\"discohook\", 10, {\n    upgrade: (database, oldVersion, newVersion, transaction) => {\n      // Casting to unknown schema, because upgrades shouldn't assume how the\n      // schema looks at that time\n      upgradeDatabase(database, transaction, oldVersion).then(() => {\n        var _document$querySelect;\n\n        localStorage.setItem(\"database-upgraded-version\", \"10\");\n        (_document$querySelect = document.querySelector(\"#db-upgrade-blocked\")) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.remove();\n      }).catch(error => {\n        console.error(\"Error on database upgrade:\", error);\n      });\n    },\n    blocked: showUpgradeBlockedMessage\n  });\n};","map":{"version":3,"sources":["F:/DiscordHookSite/modules/database/connection/openDatabase.ts"],"names":["openDB","showUpgradeBlockedMessage","upgradeDatabase","openDatabase","upgrade","database","oldVersion","newVersion","transaction","then","localStorage","setItem","document","querySelector","remove","catch","error","console","blocked"],"mappings":"AAAA,SAAwCA,MAAxC,QAAsD,KAAtD;AAEA,SAASC,yBAAT,QAA0C,6BAA1C;AACA,SAASC,eAAT,QAAgC,mBAAhC;AAEA,OAAO,MAAMC,YAAY,GAAG,YAAY;AACtC,SAAOH,MAAM,CAAS,WAAT,EAAsB,EAAtB,EAA0B;AACrCI,IAAAA,OAAO,EAAE,CAACC,QAAD,EAAWC,UAAX,EAAuBC,UAAvB,EAAmCC,WAAnC,KAAmD;AAC1D;AACA;AACAN,MAAAA,eAAe,CACbG,QADa,EAEbG,WAFa,EAGbF,UAHa,CAAf,CAKGG,IALH,CAKQ,MAAM;AAAA;;AACVC,QAAAA,YAAY,CAACC,OAAb,CAAqB,2BAArB,EAAkD,IAAlD;AACA,iCAAAC,QAAQ,CAACC,aAAT,CAAuB,qBAAvB,iFAA+CC,MAA/C;AACD,OARH,EASGC,KATH,CASSC,KAAK,IAAI;AACdC,QAAAA,OAAO,CAACD,KAAR,CAAc,4BAAd,EAA4CA,KAA5C;AACD,OAXH;AAYD,KAhBoC;AAiBrCE,IAAAA,OAAO,EAAEjB;AAjB4B,GAA1B,CAAb;AAmBD,CApBM","sourcesContent":["import { IDBPDatabase, IDBPTransaction, openDB } from \"idb\"\r\nimport type { Schema } from \"../Schema\"\r\nimport { showUpgradeBlockedMessage } from \"./showUpgradeBlockedMessage\"\r\nimport { upgradeDatabase } from \"./upgradeDatabase\"\r\n\r\nexport const openDatabase = async () => {\r\n  return openDB<Schema>(\"discohook\", 10, {\r\n    upgrade: (database, oldVersion, newVersion, transaction) => {\r\n      // Casting to unknown schema, because upgrades shouldn't assume how the\r\n      // schema looks at that time\r\n      upgradeDatabase(\r\n        database as IDBPDatabase,\r\n        transaction as IDBPTransaction<unknown, string[], \"versionchange\">,\r\n        oldVersion,\r\n      )\r\n        .then(() => {\r\n          localStorage.setItem(\"database-upgraded-version\", \"10\")\r\n          document.querySelector(\"#db-upgrade-blocked\")?.remove()\r\n        })\r\n        .catch(error => {\r\n          console.error(\"Error on database upgrade:\", error)\r\n        })\r\n    },\r\n    blocked: showUpgradeBlockedMessage,\r\n  })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}